<html>

  <head>
    <style>
      body,
      document {
        margin: 0;
        padding: 0;
      }

      .main {
        width: 100%;
        height: 100%;
        position: relative;
      }

      .thing {
        width: 10px;
        height: 10px;
        background-color: #0f0;
        border-radius: 50%;
        position: absolute;
      }

      .red {
        background-color: #f00;
      }

      .blue {
        background-color: #00f;
      }
    </style>
    <script src="/js/helper.js"></script>
    <script src="/lib/triplet.js"></script>
    <script src="/lib/pos.js"></script>
    <script src="/lib/kinematics.js"></script>
    <script src="/lib/leg.js"></script>
    <script src="/lib/mockJohnny.js"></script>
  </head>

  <body>
    <div id="main" class="main"></div>

    <script>
      let x = 200;
      let y = 200;
      let z = 100;
      const limbLength = 100;
      const page = document.getElementById('main')
      const d = document.createElement('div')
      const newContent = document.createTextNode('Hi there and greetings!')

      const delay = (ms) => {
        return new Promise(resolve => {
          setTimeout(resolve, ms)
        })
      }

      const drawDot = (x1, y1, col='') => {
        const d = document.createElement('div')
        d.className = `thing ${col}`
        d.style.left = (x1 * 2) + 'px'
        d.style.top = (y1 * 2) + 'px'
        // console.log(`${x1},${y1}`)
        page.appendChild(d)
      }

      const testLeg = async () => {
        const driver = new JohnnyDriver()
        const servoSettings = {
          range: [
            40, 90
          ],
          startAt: 90,
          controller: 'PCA9685'
        }
        const legConfig = {
          femurLength: 100,
          tibiaLength: 100,
          driver,
          hipServoSettings: servoSettings,
          femurServoSettings: servoSettings,
          kneeServoSettings: servoSettings
        }
        const leg = new Leg({
          ...legConfig,
          id: 0,
          name: 'front-left',
          startPos: 0
        })

        let step = 0
        const steps = 72

        console.log(leg)
        drawDot(200, 200-leg.position.t2, 'red')

        const run = () => {
          leg.nextStep(step)
          const xyz = calculateXyz(leg.position)
          const {t1: x, t2: y} = xyz
          // console.log(x, y)
          drawDot(200 + (x * 3), 200 + (y ))
          step++
          if (step === steps) {
            step = 0
          }
        }

        setInterval(run, 200)
      }

      testLeg()
    </script>
  </body>

</html>